name: 'Node.js Build and Test'
description: 'Setup Node.js, install dependencies, build TypeScript, and run tests'
inputs:
  node_version:
    description: 'Node.js version to use'
    required: false
    default: '20'
  cache:
    description: 'Enable npm cache'
    required: false
    default: 'npm'
runs:
  using: "composite"
  steps:
    - name: ðŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node_version }}
        cache: ${{ inputs.cache }}

    - name: ðŸ“¥ Install dependencies
      shell: bash
      run: |
        echo "ðŸ“¥ Installing dependencies..."
        npm ci
        echo "âœ… Dependencies installed successfully"

    - name: ðŸ”¨ Build TypeScript
      shell: bash
      run: |
        echo "ðŸ”¨ Building TypeScript..."
        npm run build
        echo "âœ… Build completed successfully"

    - name: ðŸ§ª Run tests
      shell: bash
      run: |
        if npm run test --dry-run 2>/dev/null; then
          echo "ðŸ§ª Running tests..."
          npm test
          echo "âœ… Tests completed successfully"
        else
          echo "âš ï¸ No tests found, skipping test step"
        fi

    - name: ðŸ” Lint code
      shell: bash
      run: |
        if npm run lint --dry-run 2>/dev/null; then
          echo "ðŸ” Running linter..."
          npm run lint
          echo "âœ… Linting completed successfully"
        else
          echo "âš ï¸ No linter configured, skipping lint step"
        fi

    - name: ðŸ“Š Build summary
      shell: bash
      run: |
        echo "ðŸ“Š Build Summary:"
        echo "  - Node.js version: $(node --version)"
        echo "  - npm version: $(npm --version)"
        echo "  - Build output size: $(du -sh dist/ 2>/dev/null || echo 'No dist folder')"
        echo "  - Package size: $(du -sh node_modules/ 2>/dev/null || echo 'No node_modules')"
